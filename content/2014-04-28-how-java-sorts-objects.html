<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Ng Zhi An - How Java sorts Objects</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <link href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">$fancy-logo$</a>
            </div>
            <div id="navigation">
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>How Java sorts Objects</h1>

            <div class="info">
    Posted on April 28, 2014
    
</div>

<h2 id="it-started-with-an-experiment-on-sorting">It started with an experiment on sorting…</h2>
<p>The reason why I had this question in my head was because I was wondering <a href="../posts/2014-04-28-scissors-paper-stone-and-ordering.html">how sorting would look like for Scissors, Paper, Stone objects</a>, since they have a <a href="https://en.wikipedia.org/wiki/Cyclic_order">cyclic ordering</a>. And in that little experiment I used Java’s <code>Collections.sort</code> method, which is really useful if the class you wish to sort implements <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html"><code>Comparable</code></a>, and that just requires you to define a single method <code>compareTo</code>. So I went ahead to investigate how Java implements this method. My initial guess was that for small collections, insertion sort would be used, because it’s actually more efficient. But for larger collections, mergesort/quicksort would be used. Eventually I found out I was wrong, here’s why.</p>
<h2 id="grep-that-method">Grep that method</h2>
<p><a href="grepcode.com">GrepCode</a> is a wonderful resource. It lets you search the code bases of many open source projects including Java and Eclipse, and there’s so much to learn from robust code that is being used by so many people.</p>
<p>A simple search for <code>Collections.sort</code> took me <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7u40-b43/java/util/Collections.java#Collections.sort%28java.util.List%29">here</a>.</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> &lt;T <span class="kw">extends</span> Comparable&lt;? <span class="kw">super</span> T&gt;&gt; <span class="dt">void</span>  [More ...] <span class="fu">sort</span>(List&lt;T&gt; list) {
  Object[] a = list.<span class="fu">toArray</span>();
  Arrays.<span class="fu">sort</span>(a);
  ListIterator&lt;T&gt; i = list.<span class="fu">listIterator</span>();
  <span class="kw">for</span> (<span class="dt">int</span> j=<span class="dv">0</span>; j&lt;a.<span class="fu">length</span>; j++) {
    i.<span class="fu">next</span>();
    i.<span class="fu">set</span>((T)a[j]);
  }
}</code></pre>
<p>So actually <code>Collections.sort</code> converts the collection of objects into an <code>Array</code> internally, and uses <code>Arrays.sort</code>. Sounds like a simple way to <a href="http://www.c2.com/cgi/wiki?DontRepeatYourself">reduce duplication of code</a>!</p>
<h2 id="digging-deeper-into-arrays.sort">Digging deeper into <code>Arrays.sort</code></h2>
<p>So I looked into <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7u40-b43/java/util/Arrays.java#Arrays.sort%28java.lang.Object[]%29"><code>Array.sort</code></a> and see that <code>Arrays.sort</code> uses either <code>legacyMergeSort</code> or something called <code>ComparableTimSort</code>.</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span>  [More ...] <span class="fu">sort</span>(Object[] a) {
  <span class="kw">if</span> (LegacyMergeSort.<span class="fu">userRequested</span>)
    <span class="fu">legacyMergeSort</span>(a);
  <span class="kw">else</span>
    ComparableTimSort.<span class="fu">sort</span>(a);
}</code></pre>
<p>Well I know <a href="https://en.wikipedia.org/wiki/Mergesort">mergesort</a>, and it seems like you need to set some system parameter to use it, so my guess is that it isn’t used most of the time. How about the other one, <code>ComparableTimSort</code>?</p>
<h2 id="tims-sort">Tim’s sort</h2>
<p>I’ve never heard of such a sort before, so I continued investigating and reached the <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7u40-b43/java/util/ComparableTimSort.java#ComparableTimSort.sort%28java.lang.Object[]%29">method definition</a>, which said this was just like <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7u40-b43/java/util/TimSort.java#TimSort">TimSort</a>.</p>
<p>The comments for the <code>TimSort</code> class actually describes the history of <a href="https://en.wikipedia.org/wiki/Timsort">TimSort</a>, which was first used by Python!</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="co">// A stable, adaptive, iterative mergesort that requires far fewer than n lg(n)</span>
<span class="co">// comparisons when running on partially sorted arrays, while offering</span>
<span class="co">// performance comparable to a traditional mergesort when run on random arrays.</span>
<span class="co">// Like all proper mergesorts, this sort is stable and runs O(n log n) time (worst case).</span></code></pre>
<p>I haven’t completely figured out how it works, but it has <code>O(n)</code> best case performance, and performs very well on real world data. Here’s a <a href="https://svn.python.org/projects/python/trunk/Objects/listsort.txt">description of the algorithm</a> by its author Tim Peters, and a <a href="http://sortvis.org/algorithms/timsort.html">cool visualization</a> of the process. Oh by the way that previous website, <a href="http://sortvis.org">sortvis</a> has visualizations of other sorting algorithms as well, check it out!</p>
<h2 id="so">So…</h2>
<p>I don’t really understand Tim’s sort as for now, and I think this won’t be the last time I’ll see it, but at least know I know how Java sorts stuff :)</p>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
